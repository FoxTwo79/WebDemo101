import requests
import urllib.parse
import csv
import time
from requests.adapters import HTTPAdapter, Retry


def fetch_market_data(length=50, max_retries=3, backoff=5):
    """
    Fetch market data from marketchameleon.com with retry and timeout handling.
    """
    url = "https://marketchameleon.com/EquityScreener/EquityScreenerData"

    headers = {
        "accept": "application/json, text/javascript, */*; q=0.01", 
        "accept-language": "en-US,en;q=0.9",
        "content-type": "application/x-www-form-urlencoded; charset=UTF-8",
        "priority": "u=1, i", 
        "sec-ch-ua": "\"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"138\", \"Google Chrome\";v=\"138\"", 
        "sec-ch-ua-mobile": "?0", 
        "sec-ch-ua-platform": "\"Windows\"", 
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors", "sec-fetch-site": "same-origin", "x-mobdisp": "false", "x-requested-with": "XMLHttpRequest", 
        "cookie": "ASP.NET_SessionId=0ex2dorixsdtl3jaofwoa4ww; v1=56611791; RT=\"z=1&dm=marketchameleon.com&si=flbop11cccc&ss=mejr56ix&sl=0&tt=0\"; _ga=GA1.1.829383096.1755681012; _ga_CXRDD1LJF1=GS2.1.s1755681012$o1$g0$t1755681012$j60$l0$h0; PAPVisitorId=Q8nFNfj4IBdURQ5EgRdfdUBX5rzIUjD0; ak_bmsc=EA467DBDF9488F3E9F8EE256761DC5AC~000000000000000000000000000000~YAAQCxzFF7RK26aYAQAACz++xhxk3yaJA+emkhKDhiDY6mTHt6KNoJP9VXpr8GTjS+7y/+b0p9vL8y1wSc350KJKqVH3B8h+wVii5zMuAeObJ9lfdjXzh5tYl1jzXzj9//vnHg3+diBERB6tB1b8D/SAigxAH5edKnndT7gSqjXan0nzOItUjxa+BUPgjMcFcQ2NZosO/2yjRV6ymtfOjS16OYYvcJ00DzsYan3CK6j2jXlcjhmsViOD4JxKQPV8gzyeFCbPCwhpz0zMD/XgWeC56Ys8Nhk8FmNNUxT7OkvfK9Y2/lFkUKl9pWZF435+6prBTG9X6JV7fYHTD2cFOTAq/fJbFnyWp2kn+q97DXUVU6IfLrRNcolsbn9c/9tIzP4brRKoArO145D4Kby7LlvCsKz4QEwdq0dMYeen5E15pCr43X6MJ2B57+kedNbdJ0g5FPg4Gnq34g4Aw35k5JY=; bm_sv=3627E19C83B5CA3E96E9D379CC09CE7C~YAAQCxzFF/9K26aYAQAAAYK+xhzSQrlLZI8AGKkPUdp/wXsHH36gyUcbxDNg18RZJiWTxAcX5IzbM0MgmCFoZbtsgdsQPRDzOocB0Ks8TCVPpAvFy1ajfF1FBiLqzvxkTpbPD45+ONSZVoy2nL2Z5WurqQfYOYnKSuEdK2PhOIaEhlcppoO0v1ald6OYhoGG5Pk7iOZK6xkvhvfpISU8O84SIg7FVdBF7W2MkqMdf6kTBCUXhV5TL24joQhOmmZ09razHGFTbZP+~1", 
        "Referer": "https://marketchameleon.com/Screeners/Stocks"
    }

    # # Example payload (adjust columns as needed)
    # payload = {
    #     "draw": 1,
    #     "start": 0,
    #     "length": length,
    #     "search[value]": "",
    #     "search[regex]": "false",
    #     "columns[0][data]": "Symbol",
    #     "columns[0][name]": "c0",
    #     "columns[0][searchable]": "true",
    #     "columns[0][orderable]": "true",
    #     "columns[0][search][value]": "",
    #     "columns[0][search][regex]": "false",
    # }

    encoded_payload = "draw=8&columns%5B0%5D%5Bdata%5D=Symbol&columns%5B0%5D%5Bname%5D=c0&columns%5B0%5D%5Bsearchable%5D=true&columns%5B0%5D%5Borderable%5D=true&columns%5B0%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B0%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B1%5D%5Bdata%5D=BD.Name&columns%5B1%5D%5Bname%5D=c1&columns%5B1%5D%5Bsearchable%5D=true&columns%5B1%5D%5Borderable%5D=true&columns%5B1%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B1%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B2%5D%5Bdata%5D=BD.Px&columns%5B2%5D%5Bname%5D=c2&columns%5B2%5D%5Bsearchable%5D=true&columns%5B2%5D%5Borderable%5D=true&columns%5B2%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B2%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B3%5D%5Bdata%5D=BD.PxChgPct&columns%5B3%5D%5Bname%5D=c3&columns%5B3%5D%5Bsearchable%5D=true&columns%5B3%5D%5Borderable%5D=true&columns%5B3%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B3%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B4%5D%5Bdata%5D=BD.Volume&columns%5B4%5D%5Bname%5D=c6&columns%5B4%5D%5Bsearchable%5D=true&columns%5B4%5D%5Borderable%5D=true&columns%5B4%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B4%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B5%5D%5Bdata%5D=BD.AvgVolume&columns%5B5%5D%5Bname%5D=c51&columns%5B5%5D%5Bsearchable%5D=true&columns%5B5%5D%5Borderable%5D=true&columns%5B5%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B5%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B6%5D%5Bdata%5D=BD.RelVolume&columns%5B6%5D%5Bname%5D=c7&columns%5B6%5D%5Bsearchable%5D=true&columns%5B6%5D%5Borderable%5D=true&columns%5B6%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B6%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B7%5D%5Bdata%5D=BD.MarketCap&columns%5B7%5D%5Bname%5D=c8&columns%5B7%5D%5Bsearchable%5D=true&columns%5B7%5D%5Borderable%5D=true&columns%5B7%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B7%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B8%5D%5Bdata%5D=BD.DivYield&columns%5B8%5D%5Bname%5D=c9&columns%5B8%5D%5Bsearchable%5D=true&columns%5B8%5D%5Borderable%5D=true&columns%5B8%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B8%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B9%5D%5Bdata%5D=Fm.pe_ratio&columns%5B9%5D%5Bname%5D=c10&columns%5B9%5D%5Bsearchable%5D=true&columns%5B9%5D%5Borderable%5D=true&columns%5B9%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B9%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B10%5D%5Bdata%5D=BD.Chg2D&columns%5B10%5D%5Bname%5D=c53&columns%5B10%5D%5Bsearchable%5D=true&columns%5B10%5D%5Borderable%5D=true&columns%5B10%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B10%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B11%5D%5Bdata%5D=BD.Chg3D&columns%5B11%5D%5Bname%5D=c54&columns%5B11%5D%5Bsearchable%5D=true&columns%5B11%5D%5Borderable%5D=true&columns%5B11%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B11%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B12%5D%5Bdata%5D=BD.Chg4D&columns%5B12%5D%5Bname%5D=c55&columns%5B12%5D%5Bsearchable%5D=true&columns%5B12%5D%5Borderable%5D=true&columns%5B12%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B12%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B13%5D%5Bdata%5D=BD.Chg5D&columns%5B13%5D%5Bname%5D=c56&columns%5B13%5D%5Bsearchable%5D=true&columns%5B13%5D%5Borderable%5D=true&columns%5B13%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B13%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B14%5D%5Bdata%5D=BD.Chg6D&columns%5B14%5D%5Bname%5D=c57&columns%5B14%5D%5Bsearchable%5D=true&columns%5B14%5D%5Borderable%5D=true&columns%5B14%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B14%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B15%5D%5Bdata%5D=BD.Chg7D&columns%5B15%5D%5Bname%5D=c58&columns%5B15%5D%5Bsearchable%5D=true&columns%5B15%5D%5Borderable%5D=true&columns%5B15%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B15%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B16%5D%5Bdata%5D=BD.Chg2Wk&columns%5B16%5D%5Bname%5D=c11&columns%5B16%5D%5Bsearchable%5D=true&columns%5B16%5D%5Borderable%5D=true&columns%5B16%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B16%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B17%5D%5Bdata%5D=BD.Chg3M&columns%5B17%5D%5Bname%5D=c12&columns%5B17%5D%5Bsearchable%5D=true&columns%5B17%5D%5Borderable%5D=true&columns%5B17%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B17%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B18%5D%5Bdata%5D=BD.Chg6M&columns%5B18%5D%5Bname%5D=c13&columns%5B18%5D%5Bsearchable%5D=true&columns%5B18%5D%5Borderable%5D=true&columns%5B18%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B18%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B19%5D%5Bdata%5D=BD.Chg1Y&columns%5B19%5D%5Bname%5D=c14&columns%5B19%5D%5Bsearchable%5D=true&columns%5B19%5D%5Borderable%5D=true&columns%5B19%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B19%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B20%5D%5Bdata%5D=BD.ChgYTD&columns%5B20%5D%5Bname%5D=c15&columns%5B20%5D%5Bsearchable%5D=true&columns%5B20%5D%5Borderable%5D=true&columns%5B20%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B20%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B21%5D%5Bdata%5D=BD.Chg3Y&columns%5B21%5D%5Bname%5D=c200&columns%5B21%5D%5Bsearchable%5D=true&columns%5B21%5D%5Borderable%5D=true&columns%5B21%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B21%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B22%5D%5Bdata%5D=BD.Chg5Y&columns%5B22%5D%5Bname%5D=c201&columns%5B22%5D%5Bsearchable%5D=true&columns%5B22%5D%5Borderable%5D=true&columns%5B22%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B22%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B23%5D%5Bdata%5D=BD.ChgCloseToOpen&columns%5B23%5D%5Bname%5D=c4&columns%5B23%5D%5Bsearchable%5D=true&columns%5B23%5D%5Borderable%5D=true&columns%5B23%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B23%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B24%5D%5Bdata%5D=BD.ChgOpenPx&columns%5B24%5D%5Bname%5D=c5&columns%5B24%5D%5Bsearchable%5D=true&columns%5B24%5D%5Borderable%5D=true&columns%5B24%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B24%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B25%5D%5Bdata%5D=BD.Chg52WLo&columns%5B25%5D%5Bname%5D=c16&columns%5B25%5D%5Bsearchable%5D=true&columns%5B25%5D%5Borderable%5D=true&columns%5B25%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B25%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B26%5D%5Bdata%5D=BD.Chg52WHi&columns%5B26%5D%5Bname%5D=c17&columns%5B26%5D%5Bsearchable%5D=true&columns%5B26%5D%5Borderable%5D=true&columns%5B26%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B26%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B27%5D%5Bdata%5D=BD.ChgMA20&columns%5B27%5D%5Bname%5D=c18&columns%5B27%5D%5Bsearchable%5D=true&columns%5B27%5D%5Borderable%5D=true&columns%5B27%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B27%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B28%5D%5Bdata%5D=BD.ChgMA50&columns%5B28%5D%5Bname%5D=c19&columns%5B28%5D%5Bsearchable%5D=true&columns%5B28%5D%5Borderable%5D=true&columns%5B28%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B28%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B29%5D%5Bdata%5D=BD.ChgMA250&columns%5B29%5D%5Bname%5D=c20&columns%5B29%5D%5Bsearchable%5D=true&columns%5B29%5D%5Borderable%5D=true&columns%5B29%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B29%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B30%5D%5Bdata%5D=BD.IV30&columns%5B30%5D%5Bname%5D=c21&columns%5B30%5D%5Bsearchable%5D=true&columns%5B30%5D%5Borderable%5D=true&columns%5B30%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B30%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B31%5D%5Bdata%5D=BD.IV30Chg&columns%5B31%5D%5Bname%5D=c22&columns%5B31%5D%5Bsearchable%5D=true&columns%5B31%5D%5Borderable%5D=true&columns%5B31%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B31%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B32%5D%5Bdata%5D=BD.OptVolume&columns%5B32%5D%5Bname%5D=c23&columns%5B32%5D%5Bsearchable%5D=true&columns%5B32%5D%5Borderable%5D=true&columns%5B32%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B32%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B33%5D%5Bdata%5D=BD.RelOptVolume&columns%5B33%5D%5Bname%5D=c24&columns%5B33%5D%5Bsearchable%5D=true&columns%5B33%5D%5Borderable%5D=true&columns%5B33%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B33%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B34%5D%5Bdata%5D=BD.IVRank&columns%5B34%5D%5Bname%5D=c25&columns%5B34%5D%5Bsearchable%5D=true&columns%5B34%5D%5Borderable%5D=true&columns%5B34%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B34%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B35%5D%5Bdata%5D=BD.Sector&columns%5B35%5D%5Bname%5D=c26&columns%5B35%5D%5Bsearchable%5D=true&columns%5B35%5D%5Borderable%5D=true&columns%5B35%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B35%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B36%5D%5Bdata%5D=BD.Industry&columns%5B36%5D%5Bname%5D=c27&columns%5B36%5D%5Bsearchable%5D=true&columns%5B36%5D%5Borderable%5D=true&columns%5B36%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B36%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B37%5D%5Bdata%5D=BD.EquityType&columns%5B37%5D%5Bname%5D=c28&columns%5B37%5D%5Bsearchable%5D=true&columns%5B37%5D%5Borderable%5D=true&columns%5B37%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B37%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B38%5D%5Bdata%5D=BD.DivGrowth1Yr&columns%5B38%5D%5Bname%5D=c32&columns%5B38%5D%5Bsearchable%5D=true&columns%5B38%5D%5Borderable%5D=true&columns%5B38%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B38%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B39%5D%5Bdata%5D=BD.DivGrowth3Yr&columns%5B39%5D%5Bname%5D=c33&columns%5B39%5D%5Bsearchable%5D=true&columns%5B39%5D%5Borderable%5D=true&columns%5B39%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B39%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B40%5D%5Bdata%5D=BD.PayoutRatio&columns%5B40%5D%5Bname%5D=c34&columns%5B40%5D%5Bsearchable%5D=true&columns%5B40%5D%5Borderable%5D=true&columns%5B40%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B40%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B41%5D%5Bdata%5D=BD.RSI14&columns%5B41%5D%5Bname%5D=c45&columns%5B41%5D%5Bsearchable%5D=true&columns%5B41%5D%5Borderable%5D=true&columns%5B41%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B41%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B42%5D%5Bdata%5D=BD.DivIncreases3Yr&columns%5B42%5D%5Bname%5D=c46&columns%5B42%5D%5Bsearchable%5D=true&columns%5B42%5D%5Borderable%5D=true&columns%5B42%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B42%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B43%5D%5Bdata%5D=BD.DivDecreases3Yr&columns%5B43%5D%5Bname%5D=c47&columns%5B43%5D%5Bsearchable%5D=true&columns%5B43%5D%5Borderable%5D=true&columns%5B43%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B43%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B44%5D%5Bdata%5D=BD.Vol1Day&columns%5B44%5D%5Bname%5D=c48&columns%5B44%5D%5Bsearchable%5D=true&columns%5B44%5D%5Borderable%5D=true&columns%5B44%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B44%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B45%5D%5Bdata%5D=BD.Vol20Day&columns%5B45%5D%5Bname%5D=c49&columns%5B45%5D%5Bsearchable%5D=true&columns%5B45%5D%5Borderable%5D=true&columns%5B45%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B45%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B46%5D%5Bdata%5D=BD.Vol1Year&columns%5B46%5D%5Bname%5D=c50&columns%5B46%5D%5Bsearchable%5D=true&columns%5B46%5D%5Borderable%5D=true&columns%5B46%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B46%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B47%5D%5Bdata%5D=BD.Skew25DSort&columns%5B47%5D%5Bname%5D=c52&columns%5B47%5D%5Bsearchable%5D=true&columns%5B47%5D%5Borderable%5D=true&columns%5B47%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B47%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B48%5D%5Bdata%5D=BD.Country&columns%5B48%5D%5Bname%5D=c80&columns%5B48%5D%5Bsearchable%5D=true&columns%5B48%5D%5Borderable%5D=true&columns%5B48%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B48%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B49%5D%5Bdata%5D=BD.ShrOut&columns%5B49%5D%5Bname%5D=c90&columns%5B49%5D%5Bsearchable%5D=true&columns%5B49%5D%5Borderable%5D=true&columns%5B49%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B49%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B50%5D%5Bdata%5D=BD.ShrFloat&columns%5B50%5D%5Bname%5D=c91&columns%5B50%5D%5Bsearchable%5D=true&columns%5B50%5D%5Borderable%5D=true&columns%5B50%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B50%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B51%5D%5Bdata%5D=BD.MA_20D&columns%5B51%5D%5Bname%5D=MA_20D&columns%5B51%5D%5Bsearchable%5D=true&columns%5B51%5D%5Borderable%5D=true&columns%5B51%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B51%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B52%5D%5Bdata%5D=BD.MA_50D&columns%5B52%5D%5Bname%5D=MA_50D&columns%5B52%5D%5Bsearchable%5D=true&columns%5B52%5D%5Borderable%5D=true&columns%5B52%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B52%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B53%5D%5Bdata%5D=BD.MA_250D&columns%5B53%5D%5Bname%5D=MA_250D&columns%5B53%5D%5Bsearchable%5D=true&columns%5B53%5D%5Borderable%5D=true&columns%5B53%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B53%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B54%5D%5Bdata%5D=BD.MA_20v50&columns%5B54%5D%5Bname%5D=_20MA_vs_50MA&columns%5B54%5D%5Bsearchable%5D=true&columns%5B54%5D%5Borderable%5D=true&columns%5B54%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B54%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B55%5D%5Bdata%5D=BD.MA_20v250&columns%5B55%5D%5Bname%5D=_20MA_vs_250MA&columns%5B55%5D%5Bsearchable%5D=true&columns%5B55%5D%5Borderable%5D=true&columns%5B55%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B55%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B56%5D%5Bdata%5D=BD.MA_50v250&columns%5B56%5D%5Bname%5D=_50MA_vs_250MA&columns%5B56%5D%5Bsearchable%5D=true&columns%5B56%5D%5Borderable%5D=true&columns%5B56%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B56%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B57%5D%5Bdata%5D=BD.MA_Name&columns%5B57%5D%5Bname%5D=c59&columns%5B57%5D%5Bsearchable%5D=true&columns%5B57%5D%5Borderable%5D=true&columns%5B57%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B57%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B58%5D%5Bdata%5D=BD.StockSD_Out&columns%5B58%5D%5Bname%5D=c60&columns%5B58%5D%5Bsearchable%5D=true&columns%5B58%5D%5Borderable%5D=true&columns%5B58%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B58%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B59%5D%5Bdata%5D=BD.DayVWMinSD&columns%5B59%5D%5Bname%5D=c81&columns%5B59%5D%5Bsearchable%5D=true&columns%5B59%5D%5Borderable%5D=true&columns%5B59%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B59%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B60%5D%5Bdata%5D=BD.DayVWAP&columns%5B60%5D%5Bname%5D=c82&columns%5B60%5D%5Bsearchable%5D=true&columns%5B60%5D%5Borderable%5D=true&columns%5B60%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B60%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B61%5D%5Bdata%5D=BD.DayVWPlusSD&columns%5B61%5D%5Bname%5D=c83&columns%5B61%5D%5Bsearchable%5D=true&columns%5B61%5D%5Borderable%5D=true&columns%5B61%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B61%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B62%5D%5Bdata%5D=BD.PvVWStd&columns%5B62%5D%5Bname%5D=c84&columns%5B62%5D%5Bsearchable%5D=true&columns%5B62%5D%5Borderable%5D=true&columns%5B62%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B62%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B63%5D%5Bdata%5D=BD.PvVWPct&columns%5B63%5D%5Bname%5D=c85&columns%5B63%5D%5Bsearchable%5D=true&columns%5B63%5D%5Borderable%5D=true&columns%5B63%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B63%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B64%5D%5Bdata%5D=BD.VwSD&columns%5B64%5D%5Bname%5D=c86&columns%5B64%5D%5Bsearchable%5D=true&columns%5B64%5D%5Borderable%5D=true&columns%5B64%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B64%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B65%5D%5Bdata%5D=Fm.pe_ratio&columns%5B65%5D%5Bname%5D=c101&columns%5B65%5D%5Bsearchable%5D=true&columns%5B65%5D%5Borderable%5D=true&columns%5B65%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B65%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B66%5D%5Bdata%5D=Fm.pe_normalized_eps&columns%5B66%5D%5Bname%5D=c102&columns%5B66%5D%5Bsearchable%5D=true&columns%5B66%5D%5Borderable%5D=true&columns%5B66%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B66%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B67%5D%5Bdata%5D=Fm.px_to_sales&columns%5B67%5D%5Bname%5D=c103&columns%5B67%5D%5Bsearchable%5D=true&columns%5B67%5D%5Borderable%5D=true&columns%5B67%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B67%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B68%5D%5Bdata%5D=Fm.px_to_bookval&columns%5B68%5D%5Bname%5D=c104&columns%5B68%5D%5Bsearchable%5D=true&columns%5B68%5D%5Borderable%5D=true&columns%5B68%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B68%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B69%5D%5Bdata%5D=Fm.px_to_tangiblebookval&columns%5B69%5D%5Bname%5D=c105&columns%5B69%5D%5Bsearchable%5D=true&columns%5B69%5D%5Borderable%5D=true&columns%5B69%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B69%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B70%5D%5Bdata%5D=Fm.peg_ratio&columns%5B70%5D%5Bname%5D=c106&columns%5B70%5D%5Bsearchable%5D=true&columns%5B70%5D%5Borderable%5D=true&columns%5B70%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B70%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B71%5D%5Bdata%5D=Fm.px_to_cash&columns%5B71%5D%5Bname%5D=c107&columns%5B71%5D%5Bsearchable%5D=true&columns%5B71%5D%5Borderable%5D=true&columns%5B71%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B71%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B72%5D%5Bdata%5D=Fm.px_to_freecashflow&columns%5B72%5D%5Bname%5D=c108&columns%5B72%5D%5Bsearchable%5D=true&columns%5B72%5D%5Borderable%5D=true&columns%5B72%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B72%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B73%5D%5Bdata%5D=Fm.px_to_ebitda&columns%5B73%5D%5Bname%5D=c109&columns%5B73%5D%5Bsearchable%5D=true&columns%5B73%5D%5Borderable%5D=true&columns%5B73%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B73%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B74%5D%5Bdata%5D=Fm.forward_pe_ratio&columns%5B74%5D%5Bname%5D=c110&columns%5B74%5D%5Bsearchable%5D=true&columns%5B74%5D%5Borderable%5D=true&columns%5B74%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B74%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B75%5D%5Bdata%5D=Fm.peg_pay_back&columns%5B75%5D%5Bname%5D=c111&columns%5B75%5D%5Bsearchable%5D=true&columns%5B75%5D%5Borderable%5D=true&columns%5B75%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B75%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B76%5D%5Bdata%5D=Fm.price_to_cfo&columns%5B76%5D%5Bname%5D=c112&columns%5B76%5D%5Bsearchable%5D=true&columns%5B76%5D%5Borderable%5D=true&columns%5B76%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B76%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B77%5D%5Bdata%5D=Fm.ev_to_ebitda&columns%5B77%5D%5Bname%5D=c113&columns%5B77%5D%5Bsearchable%5D=true&columns%5B77%5D%5Borderable%5D=true&columns%5B77%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B77%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B78%5D%5Bdata%5D=Fm.gross_margin&columns%5B78%5D%5Bname%5D=c121&columns%5B78%5D%5Bsearchable%5D=true&columns%5B78%5D%5Borderable%5D=true&columns%5B78%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B78%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B79%5D%5Bdata%5D=Fm.ebitda_margin&columns%5B79%5D%5Bname%5D=c122&columns%5B79%5D%5Bsearchable%5D=true&columns%5B79%5D%5Borderable%5D=true&columns%5B79%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B79%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B80%5D%5Bdata%5D=Fm.ebit_margin&columns%5B80%5D%5Bname%5D=c123&columns%5B80%5D%5Bsearchable%5D=true&columns%5B80%5D%5Borderable%5D=true&columns%5B80%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B80%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B81%5D%5Bdata%5D=Fm.net_profit_marg&columns%5B81%5D%5Bname%5D=c124&columns%5B81%5D%5Bsearchable%5D=true&columns%5B81%5D%5Borderable%5D=true&columns%5B81%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B81%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B82%5D%5Bdata%5D=Fm.norm_net_profit_marg&columns%5B82%5D%5Bname%5D=c125&columns%5B82%5D%5Bsearchable%5D=true&columns%5B82%5D%5Borderable%5D=true&columns%5B82%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B82%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B83%5D%5Bdata%5D=Fm.tax_rate&columns%5B83%5D%5Bname%5D=c126&columns%5B83%5D%5Bsearchable%5D=true&columns%5B83%5D%5Borderable%5D=true&columns%5B83%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B83%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B84%5D%5Bdata%5D=Fm.return_on_equity&columns%5B84%5D%5Bname%5D=c127&columns%5B84%5D%5Bsearchable%5D=true&columns%5B84%5D%5Borderable%5D=true&columns%5B84%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B84%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B85%5D%5Bdata%5D=Fm.sales_per_employee&columns%5B85%5D%5Bname%5D=c128&columns%5B85%5D%5Bsearchable%5D=true&columns%5B85%5D%5Borderable%5D=true&columns%5B85%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B85%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B86%5D%5Bdata%5D=Fm.pretax_marg&columns%5B86%5D%5Bname%5D=c129&columns%5B86%5D%5Bsearchable%5D=true&columns%5B86%5D%5Borderable%5D=true&columns%5B86%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B86%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B87%5D%5Bdata%5D=Fm.roic&columns%5B87%5D%5Bname%5D=c130&columns%5B87%5D%5Bsearchable%5D=true&columns%5B87%5D%5Borderable%5D=true&columns%5B87%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B87%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B88%5D%5Bdata%5D=Fm.ops_marg&columns%5B88%5D%5Bname%5D=c131&columns%5B88%5D%5Bsearchable%5D=true&columns%5B88%5D%5Borderable%5D=true&columns%5B88%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B88%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B89%5D%5Bdata%5D=Fm.roa&columns%5B89%5D%5Bname%5D=c132&columns%5B89%5D%5Bsearchable%5D=true&columns%5B89%5D%5Borderable%5D=true&columns%5B89%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B89%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B90%5D%5Bdata%5D=Fm.cash_return&columns%5B90%5D%5Bname%5D=c133&columns%5B90%5D%5Bsearchable%5D=true&columns%5B90%5D%5Borderable%5D=true&columns%5B90%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B90%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B91%5D%5Bdata%5D=Fm.debt_to_equity&columns%5B91%5D%5Bname%5D=c141&columns%5B91%5D%5Bsearchable%5D=true&columns%5B91%5D%5Borderable%5D=true&columns%5B91%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B91%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B92%5D%5Bdata%5D=Fm.debt_to_assets&columns%5B92%5D%5Bname%5D=c142&columns%5B92%5D%5Bsearchable%5D=true&columns%5B92%5D%5Borderable%5D=true&columns%5B92%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B92%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B93%5D%5Bdata%5D=Fm.debt_to_ebitda&columns%5B93%5D%5Bname%5D=c143&columns%5B93%5D%5Bsearchable%5D=true&columns%5B93%5D%5Borderable%5D=true&columns%5B93%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B93%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B94%5D%5Bdata%5D=Fm.debt_to_cash&columns%5B94%5D%5Bname%5D=c144&columns%5B94%5D%5Bsearchable%5D=true&columns%5B94%5D%5Borderable%5D=true&columns%5B94%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B94%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B95%5D%5Bdata%5D=Fm.interest_coverage&columns%5B95%5D%5Bname%5D=c145&columns%5B95%5D%5Bsearchable%5D=true&columns%5B95%5D%5Borderable%5D=true&columns%5B95%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B95%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B96%5D%5Bdata%5D=Fm.quick_ratio&columns%5B96%5D%5Bname%5D=c146&columns%5B96%5D%5Bsearchable%5D=true&columns%5B96%5D%5Borderable%5D=true&columns%5B96%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B96%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B97%5D%5Bdata%5D=Fm.current_ratio&columns%5B97%5D%5Bname%5D=c147&columns%5B97%5D%5Bsearchable%5D=true&columns%5B97%5D%5Borderable%5D=true&columns%5B97%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B97%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B98%5D%5Bdata%5D=Fm.debt_to_capital&columns%5B98%5D%5Bname%5D=c148&columns%5B98%5D%5Bsearchable%5D=true&columns%5B98%5D%5Borderable%5D=true&columns%5B98%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B98%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B99%5D%5Bdata%5D=Fm.financial_leverage&columns%5B99%5D%5Bname%5D=c149&columns%5B99%5D%5Bsearchable%5D=true&columns%5B99%5D%5Borderable%5D=true&columns%5B99%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B99%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B100%5D%5Bdata%5D=Fm.diluted_eps_growth&columns%5B100%5D%5Bname%5D=c161&columns%5B100%5D%5Bsearchable%5D=true&columns%5B100%5D%5Borderable%5D=true&columns%5B100%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B100%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B101%5D%5Bdata%5D=Fm.sust_growth_rate&columns%5B101%5D%5Bname%5D=c162&columns%5B101%5D%5Bsearchable%5D=true&columns%5B101%5D%5Borderable%5D=true&columns%5B101%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B101%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B102%5D%5Bdata%5D=Fm.revenue_growth&columns%5B102%5D%5Bname%5D=c163&columns%5B102%5D%5Bsearchable%5D=true&columns%5B102%5D%5Borderable%5D=true&columns%5B102%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B102%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B103%5D%5Bdata%5D=Fm.ops_income_growth&columns%5B103%5D%5Bname%5D=c164&columns%5B103%5D%5Bsearchable%5D=true&columns%5B103%5D%5Borderable%5D=true&columns%5B103%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B103%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B104%5D%5Bdata%5D=Fm.gross_profit_ann_5y_growth&columns%5B104%5D%5Bname%5D=c165&columns%5B104%5D%5Bsearchable%5D=true&columns%5B104%5D%5Borderable%5D=true&columns%5B104%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B104%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B105%5D%5Bdata%5D=Fm.cap_expend_ann_5y_growth&columns%5B105%5D%5Bname%5D=c166&columns%5B105%5D%5Bsearchable%5D=true&columns%5B105%5D%5Borderable%5D=true&columns%5B105%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B105%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B106%5D%5Bdata%5D=Fm.net_income_growth&columns%5B106%5D%5Bname%5D=c167&columns%5B106%5D%5Bsearchable%5D=true&columns%5B106%5D%5Borderable%5D=true&columns%5B106%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B106%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B107%5D%5Bdata%5D=DailyPerf15.PctPos&columns%5B107%5D%5Bname%5D=c170&columns%5B107%5D%5Bsearchable%5D=true&columns%5B107%5D%5Borderable%5D=true&columns%5B107%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B107%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B108%5D%5Bdata%5D=DailyPerf15.AvgRet&columns%5B108%5D%5Bname%5D=c171&columns%5B108%5D%5Bsearchable%5D=true&columns%5B108%5D%5Borderable%5D=true&columns%5B108%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B108%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B109%5D%5Bdata%5D=DailyPerf15.StdDev&columns%5B109%5D%5Bname%5D=c172&columns%5B109%5D%5Bsearchable%5D=true&columns%5B109%5D%5Borderable%5D=true&columns%5B109%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B109%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B110%5D%5Bdata%5D=DailyPerf15.Sharpe&columns%5B110%5D%5Bname%5D=c173&columns%5B110%5D%5Bsearchable%5D=true&columns%5B110%5D%5Borderable%5D=true&columns%5B110%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B110%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B111%5D%5Bdata%5D=DailyPerf30.PctPos&columns%5B111%5D%5Bname%5D=c174&columns%5B111%5D%5Bsearchable%5D=true&columns%5B111%5D%5Borderable%5D=true&columns%5B111%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B111%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B112%5D%5Bdata%5D=DailyPerf30.AvgRet&columns%5B112%5D%5Bname%5D=c175&columns%5B112%5D%5Bsearchable%5D=true&columns%5B112%5D%5Borderable%5D=true&columns%5B112%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B112%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B113%5D%5Bdata%5D=DailyPerf30.StdDev&columns%5B113%5D%5Bname%5D=c176&columns%5B113%5D%5Bsearchable%5D=true&columns%5B113%5D%5Borderable%5D=true&columns%5B113%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B113%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B114%5D%5Bdata%5D=DailyPerf30.Sharpe&columns%5B114%5D%5Bname%5D=c177&columns%5B114%5D%5Bsearchable%5D=true&columns%5B114%5D%5Borderable%5D=true&columns%5B114%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B114%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B115%5D%5Bdata%5D=DailyPerf90.PctPos&columns%5B115%5D%5Bname%5D=c178&columns%5B115%5D%5Bsearchable%5D=true&columns%5B115%5D%5Borderable%5D=true&columns%5B115%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B115%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B116%5D%5Bdata%5D=DailyPerf90.AvgRet&columns%5B116%5D%5Bname%5D=c179&columns%5B116%5D%5Bsearchable%5D=true&columns%5B116%5D%5Borderable%5D=true&columns%5B116%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B116%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B117%5D%5Bdata%5D=DailyPerf90.StdDev&columns%5B117%5D%5Bname%5D=c180&columns%5B117%5D%5Bsearchable%5D=true&columns%5B117%5D%5Borderable%5D=true&columns%5B117%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B117%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B118%5D%5Bdata%5D=DailyPerf90.Sharpe&columns%5B118%5D%5Bname%5D=c181&columns%5B118%5D%5Bsearchable%5D=true&columns%5B118%5D%5Borderable%5D=true&columns%5B118%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B118%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B119%5D%5Bdata%5D=InWatchlist&columns%5B119%5D%5Bname%5D=InWatchlist&columns%5B119%5D%5Bsearchable%5D=true&columns%5B119%5D%5Borderable%5D=true&columns%5B119%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B119%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B120%5D%5Bdata%5D=BD.EtfHoldingsList&columns%5B120%5D%5Bname%5D=c29&columns%5B120%5D%5Bsearchable%5D=true&columns%5B120%5D%5Borderable%5D=true&columns%5B120%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B120%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B121%5D%5Bdata%5D=BD.EarningsType&columns%5B121%5D%5Bname%5D=c30&columns%5B121%5D%5Bsearchable%5D=true&columns%5B121%5D%5Borderable%5D=true&columns%5B121%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B121%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B122%5D%5Bdata%5D=BD.HasOptions&columns%5B122%5D%5Bname%5D=c31&columns%5B122%5D%5Bsearchable%5D=true&columns%5B122%5D%5Borderable%5D=true&columns%5B122%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B122%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B123%5D%5Bdata%5D=BD.StockIdeas&columns%5B123%5D%5Bname%5D=StockIdeas&columns%5B123%5D%5Bsearchable%5D=true&columns%5B123%5D%5Borderable%5D=true&columns%5B123%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B123%5D%5Bsearch%5D%5Bregex%5D=false&order%5B0%5D%5Bcolumn%5D=3&order%5B0%5D%5Bdir%5D=desc&start=0&length=25&search%5Bvalue%5D=&search%5Bregex%5D=false"

    # Retry strategy
    retry_strategy = Retry(
        total=max_retries,
        backoff_factor=backoff,
        status_forcelist=[429, 500, 502, 503, 504],
        allowed_methods=["POST"]
    )
    adapter = HTTPAdapter()

    session = requests.Session()
    session.mount("https://", adapter)
    
    try:
        response = session.post(
            url,
            headers=headers,
            data=encoded_payload,
            timeout=30  # longer timeout
        )
        response.raise_for_status()
        return response.json()  # assuming JSON comes back
    except Exception as e:
        print(f"❌ Error fetching data: {e}")
        return None


def save_to_csv(data, filename="output.csv"):
    """
    Save fetched data into a CSV file.
    """
    if not data or "data" not in data:
        print("⚠️ No data to save")
        return

    rows = data["data"]

    if not rows:
        print("⚠️ Empty dataset")
        return

    # Extract headers dynamically
    fieldnames = rows[0].keys()

    with open(filename, "w", newline="", encoding="utf-8") as f:
        writer = csv.DictWriter(f, fieldnames=fieldnames)
        writer.writeheader()
        writer.writerows(rows)

    print(f"✅ Data saved to {filename}")


if __name__ == "__main__":
    print("📡 Fetching market data...")
    data = fetch_market_data(length=20)

    if data:
        save_to_csv(data, "market_data.csv")
